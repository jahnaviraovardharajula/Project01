(function(){class SecurePaymentForm extends HTMLElement{constructor(){super();this._root = this.attachShadow({mode:"closed"});
const e = this._root;
e.innerHTML=`<iframe id="payment-frame" sandbox="allow-scripts allow-same-origin" style="width:100%;border:0;height:200px;"></iframe><button id="submitBtn">Submit</button><div aria-live="polite"></div>`}connectedCallback(){const e=this._root
;this.frame=e.querySelector("#payment-frame"),this.submitBtn=e.querySelector("#submitBtn"),this.frame.src=this.getAttribute("iframe-src"),window.addEventListener("message",(e=>{e.origin===window.location.origin&&("validationError"===e.data.type&&this.dispatchEvent(new CustomEvent("error",{detail:e.data.message})),"validData"===e.data.type&&this.submitData(e.data.payload))})),this.submitBtn.onclick=(()=>{this.frame.contentWindow.postMessage({type:"requestSubmit"},window.location.origin)})}async submitData(e){try{const t=await fetch("http://localhost:3000/api/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),o=await t.json();if(!t.ok)throw new Error(o.error);this.dispatchEvent(new CustomEvent("submit",{detail:o}))}catch(e){this.dispatchEvent(new CustomEvent("error",{detail:e.message}))}}}customElements.define("secure-payment-form",SecurePaymentForm)})();